<!DOCTYPE html>  
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diagn√≥stico Empresarial SRM</title>

<!-- ‚úÖ FAVICONS -->
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
<link rel="manifest" href="site.webmanifest" />

<style>
  body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #f5f7fb, #e3edf9);
    color: #222;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  main {
    background: white;
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    max-width: 480px;
    width: 90%;
    padding: 1.8rem;
    text-align: center;
    animation: fadeIn 0.6s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.97); }
    to { opacity: 1; transform: scale(1); }
  }

  h1 {
    color: #0A2F7B;
    font-size: 1.4rem;
    margin-bottom: 0.8rem;
  }

  p.intro {
    color: #444;
    font-size: 1rem;
    margin-bottom: 1.5rem;
  }

  label {
    display: block;
    text-align: left;
    font-weight: 600;
    color: #0A2F7B;
    margin: 1rem 0 0.4rem;
  }

  input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #cfd6e4;
    border-radius: 8px;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  input:focus {
    border-color: #00B6C8;
    box-shadow: 0 0 0 3px rgba(0,182,200,0.15);
  }

  .opciones {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 0.6rem;
  }

  .opciones button {
    border: 1px solid #ccd3e0;
    border-radius: 10px;
    padding: 0.8rem;
    background: #f8f9fa;
    cursor: pointer;
    transition: all 0.25s ease;
    font-size: 1rem;
  }

  .opciones button:hover {
    background: #e0f7fa;
    border-color: #00B6C8;
  }

  .activo {
    background: #00B6C8 !important;
    color: white !important;
    border-color: #00B6C8 !important;
  }

  .btn {
    width: 100%;
    background: #0A2F7B;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 0.9rem;
    margin-top: 1.2rem;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .btn:hover { background: #00B6C8; }

  #final {
    display: none;
    color: #0A2F7B;
    font-size: 1.1rem;
    margin-top: 1.2rem;
    animation: fadeIn 0.4s ease;
  }

  @keyframes toastIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes spin { from { transform: rotate(0deg);} to { transform: rotate(360deg);} }
</style>
</head>
<body>
<main>
  <h1>üîç Diagn√≥stico Empresarial SRM</h1>
  <p class="intro">Descubre en pocos pasos c√≥mo potenciar tu negocio de motos | motocarros y multiplicar tus resultados.</p>

  <!-- 1Ô∏è‚É£ Datos personales -->
  <div id="pregunta1">
    <label>Tu nombre completo</label>
    <input type="text" id="nombre" required>

    <label>Correo electr√≥nico</label>
    <input type="email" id="correo" required>

    <label>WhatsApp</label>
    <input type="tel" id="whatsapp" required>

    <button id="btnContinuar" class="btn">Comenzar diagn√≥stico üöÄ</button>
  </div>

  <!-- 2Ô∏è‚É£ Tipo de empresa -->
  <div id="pregunta2" style="display:none;">
    <label>¬øQu√© describe mejor tu empresa?</label>
    <div class="opciones">
      <button data-value="Taller">Soy un taller que busca crecer y destacarse</button>
      <button data-value="Flota">Gestiono una flota y quiero optimizar costos</button>
      <button data-value="Mayorista">Soy mayorista y quiero ampliar mi mercado</button>
    </div>
  </div>

  <!-- 3Ô∏è‚É£ Empleados -->
  <div id="pregunta3" style="display:none;">
    <label>¬øCu√°ntas personas forman tu equipo actualmente?</label>
    <div class="opciones">
      <button data-value="1-5">1 a 5 empleados</button>
      <button data-value="6-20">6 a 20 empleados</button>
      <button data-value="21-50">21 a 50 empleados</button>
      <button data-value="51-100">51 a 100 empleados</button>
      <button data-value="M√°s de 100">M√°s de 100 empleados</button>
    </div>
  </div>

  <!-- 4Ô∏è‚É£ √Årea cr√≠tica -->
  <div id="pregunta4" style="display:none;">
    <label>¬øEn qu√© √°rea sientes que necesitas m√°s apoyo?</label>
    <div class="opciones">
      <button data-value="Ventas y Clientes">Atraer y fidelizar m√°s clientes</button>
      <button data-value="Inventario y Log√≠stica">Controlar y optimizar inventarios</button>
      <button data-value="Finanzas y Costos">Tener claridad y rentabilidad financiera</button>
    </div>
  </div>

  <!-- 5Ô∏è‚É£ Meta -->
  <div id="pregunta5" style="display:none;">
    <label>¬øCu√°l es tu meta m√°s importante en los pr√≥ximos 6 meses?</label>
    <div class="opciones">
      <button data-value="Aumentar ventas">Aumentar ventas y presencia en el mercado</button>
      <button data-value="Reducir costos">Reducir costos sin perder calidad</button>
      <button data-value="Digitalizaci√≥n de procesos">Digitalizar mi negocio para ganar tiempo</button>
    </div>
  </div>

  <!-- 6Ô∏è‚É£ Herramientas -->
  <div id="pregunta6" style="display:none;">
    <label>¬øQu√© herramientas digitales usas hoy para tu negocio?</label>
    <div class="opciones">
      <button data-value="Ninguna">A√∫n no uso herramientas digitales</button>
      <button data-value="Software contable">Solo manejo un software contable</button>
      <button data-value="Gesti√≥n de inventario">Uso algo para controlar inventario</button>
      <button data-value="CRM o marketing">Ya aplico sistemas de ventas o marketing</button>
    </div>
  </div>

  <div id="final">
    ‚úÖ Gracias por compartir tu informaci√≥n.<br>
    Recibir√°s una propuesta personalizada para impulsar tu negocio. üí°
  </div>

  <!-- üéµ Sonido -->
  <audio id="ping" preload="auto">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
  </audio>
</main>

<script>
/* üåê Autoajuste de API: local o Render */
const API_URL = window.location.hostname.includes("localhost")
  ? "http://localhost:10000/api/empresas"
  : "https://srm-backend-web.onrender.com/api/empresas";


const sessionId = localStorage.getItem("srm_session") || `SRM-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;
localStorage.setItem("srm_session", sessionId);
let empresa = { session_id: sessionId };

/* ‚úÖ Validaciones */
function validarEmail(correo){return /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(correo);}
function validarNombre(n){return n.trim().length>=6;}
function validarTel(t){return /^3\d{9}$/.test(t);}

/* üöÄ Continuar */
document.getElementById("btnContinuar").addEventListener("click",()=>{
  const n = document.getElementById("nombre").value.trim();
  const c = document.getElementById("correo").value.trim();
  const w = document.getElementById("whatsapp").value.trim();
  if(!validarNombre(n)){alert("Por favor ingresa tu nombre completo.");return;}
  if(!validarEmail(c)){alert("Ingresa un correo v√°lido.");return;}
  if(!validarTel(w)){alert("Ingresa un n√∫mero de WhatsApp v√°lido (10 d√≠gitos).");return;}
  empresa.nombre = n; empresa.correo = c; empresa.whatsapp = w;
  mostrar("pregunta2");
});

/* üîÑ Cambiar secci√≥n */
function mostrar(id){
  document.querySelectorAll("main > div").forEach(d=>d.style.display="none");
  document.getElementById(id).style.display="block";
}

/* üîî Sonido + toast */
function reproducirPing(){
  const ping = document.getElementById("ping");
  if(ping){ ping.volume = 0.4; ping.currentTime = 0; ping.play().catch(()=>{}); }
}

function mostrarToast(){
  const toast = document.createElement("div");
  toast.innerHTML = `‚úÖ Diagn√≥stico SRM guardado correctamente`;
  Object.assign(toast.style,{
    position:"fixed",bottom:"24px",right:"24px",
    background:"#0A2F7B",color:"#fff",padding:"12px 18px",
    borderRadius:"10px",fontFamily:"Poppins, sans-serif",
    fontSize:"14px",zIndex:"99999",animation:"toastIn 0.4s ease"
  });
  document.body.appendChild(toast);
  setTimeout(()=>toast.remove(),4000);
}

/* üì® Enviar datos */
async function enviarEmpresa(){
  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(empresa)
    });
    if(!res.ok) throw new Error("Error en servidor");
    console.log("‚úÖ Empresa guardada:", empresa);
  } catch(e){
    console.error("‚ö†Ô∏è Error al guardar empresa:", e);
  }
}

/* ‚úÖ Cierre */
function cerrarCuestionario(){
  reproducirPing();
  mostrarToast();
  enviarEmpresa();  
  document.querySelector("main").innerHTML = `
    <h2 style="color:#0A2F7B;">‚úÖ Gracias por completar tu diagn√≥stico</h2>
    <p>Recibir√°s una propuesta personalizada muy pronto.</p>`;
}

/* ‚û°Ô∏è Flujo de pasos */
function paso(selector, clave, siguiente){
  document.querySelectorAll(selector+" .opciones button").forEach(btn=>{
    btn.addEventListener("click",()=>{
      btn.classList.add("activo");
      empresa[clave] = btn.dataset.value;
      setTimeout(()=>mostrar(siguiente),300);
      if(siguiente === "final"){
        setTimeout(()=>cerrarCuestionario(),1000);
      }
    });
  });
}

paso("#pregunta2","tipo_empresa","pregunta3");
paso("#pregunta3","empleados","pregunta4");
paso("#pregunta4","area_critica","pregunta5");
paso("#pregunta5","meta_6m","pregunta6");
paso("#pregunta6","herramientas","final");
</script>
</body>
</html>
